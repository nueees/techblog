<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Docker test</h1><p class="page-description">1장-4장</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-09-02T00:00:00-05:00" itemprop="datePublished">
        Sep 2, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      1 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/techblog/categories/#kubernetes">kubernetes</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="jaewonhimnae_git"><a href="https://github.com/jaewonhimnae/docker-codes/">jaewonhimnae_git</a></h2>

<h1 id="사전-테스트">사전 테스트</h1>

<h2 id="docker-compose"><a href="https://engineer-mole.tistory.com/221">docker-compose</a></h2>
<p>여러 개의 컨테이너로부터 이루어진 서비스를 구축, 실행하는 순서를 자동으로 하여, 관리를 간단히하는 기능</p>

<h3 id="docker-compose-설치">docker-compose 설치</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># echo ${COMPOSE_VERSION} 
# curl -L https://github.com/docker/compose/releases/download/${COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose 
# chown root:docker /usr/local/bin/docker-compose 
# chmod ug+x /usr/local/bin/docker-compose 
# update-alternatives --install /usr/bin/docker-compose docker-compose /usr/local/bin/docker-compose 10
# docker-compose --version
</code></pre></div></div>

<h3 id="docker-compose-파일-위치">docker-compose 파일 위치</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(Working dir) 
+- docker-compose.yml 
+- app-server/ 
  +- Dockerfile 
  +- src/ 
    +- app.js
</code></pre></div></div>
<h3 id="docker-composeyml">docker-compose.yml</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "3"
services:
  redis-server:
    image: "redis"
  node-app:
    build: .
    ports:
      - "5000:8080"
</code></pre></div></div>

<h2 id="나머지-구동-파일들-추가">나머지 구동 파일들 추가</h2>

<h3 id="dockerfile">Dockerfile</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM node:10
WORKDIR /usr/src/app
COPY package.json ./
RUN npm install
COPY ./ ./
CMD ["node","server.js"]
</code></pre></div></div>

<h3 id="packagejson">package.json</h3>
<p>npm init으로 생성</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "name": "docker-compose-app",
  "version": "1.0.0",
  "description": "",
  "main": "server.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",
    "start": "node server.js"
  },
  "dependencies": {
    "express": "4.17.1",
    "redis": "3.0.2"
  },
  "author": "",
  "license": "ISC"
}

</code></pre></div></div>

<h3 id="serverjs">server.js</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const express = require('express');
const redis = require('redis');

const client = redis.createClient({
    host: "redis-server",  // in docker-compose.yml
    port: 6379
})

//APP 
const app = express();

client.set("number", 0);

app.get('/', (req, res) =&gt; {
    client.get("number", (err, number) =&gt; {
        res.send("number conuting: " + number)
        client.set("number", parseInt(number)+1)
    })
});

app.listen(8080);
console.log(`Server is Running`);
</code></pre></div></div>

<h2 id="docker-compose-구동">docker-compose 구동</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># docker-compose up
</code></pre></div></div>

<hr />
<p><br /><br /></p>

<h1 id="1-single-container">1. Single Container</h1>
<h2 id="11-development">1.1. Development</h2>

<h2 id="12-test">1.2. Test</h2>

<h2 id="13-deployment">1.3. Deployment</h2>

<hr />
<p><br /><br /></p>

<h1 id="2-multi-container">2. Multi Container</h1>
<h2 id="21-development">2.1. Development</h2>

<h2 id="22-test">2.2. Test</h2>

<h2 id="23-deployment">2.3. Deployment</h2>

<hr />
<p><br /><br /></p>


  </div><a class="u-url" href="/techblog/kubernetes/2021/09/02/docker-test.html" hidden></a>
</article>