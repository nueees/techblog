<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Certified Kubernetes Administrator</h1><p class="page-description">Certified Kubernetes Administrator</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2023-06-23T00:00:00-05:00" itemprop="datePublished">
        Jun 23, 2023
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      2 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/techblog/categories/#kubernetes">kubernetes</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><a href="https://www.youtube.com/watch?v=dv_5WCYS5P8&amp;list=PLApuRlvrZKojqx9-wIvWP3MPtgy2B372f&amp;index=4">따배씨</a></p>

<hr />

<h1 id="1-control-plane">1. Control Plane</h1>

<h2 id="11-etcd-backuprestore">1.1. ETCD Backup&amp;Restore</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>] ssh k8s-master
] etcd --version
] etcdctl version
</code></pre></div></div>

<h3 id="snapshot-using-etcdctl-options"><a href="https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#snapshot-using-etcdctl-options">snapshot using etcdctl options</a></h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>] sudo ETCDCTL_API=3 etcdctl \
  --endpoints=https://127.0.0.1:2379 \
  --cacert=&lt;trusted-ca-file&gt; \
  --cert=&lt;cert-file&gt; --key=&lt;key-file&gt; \
  snapshot save &lt;backup-file-location&gt;
Snapshot saved at &lt;backup-file-location&gt;
</code></pre></div></div>

<h3 id="restoring-an-etcd-cluster"><a href="https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#restoring-an-etcd-cluster">restoring an etcd cluster</a></h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>] sudo ETCDCTL_API=3 etcdctl snapshot restore \
  --data-dir &lt;new-data-dir-location&gt; &lt;backup-file-location&gt;
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>] sudo vi /etc/kubernetes/manifests/etcd.yaml
volumes:
  - hostPath:
    path: /var/lib/&lt;new-data-dir-location&gt; # edit
] sudo docker ps -a | grep etcd
</code></pre></div></div>

<h1 id="2-worker-node">2. Worker Node</h1>
<hr />
<h2 id="21-creating-pod">2.1. Creating Pod</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>] kubectl create namespace ecommerce
] kubectl -n ecommerce run eshop-main --image=nginx:1.17 --env=DB=mysql
</code></pre></div></div>

<hr />
<h2 id="22-creating-static-pod">2.2. Creating Static Pod</h2>
<p>Static Pod : directly access to kubelet in worker node without control plane API</p>
<h3 id="yaml-code-extraction-for-web-pod">yaml code extraction for web-pod</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>] kubectl -n ecommerce run web --image=nginx:1.17 -o yaml
</code></pre></div></div>
<p>save ouptut</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>] ssh hk8s-w1
] sudo -i # root mode
] cat /var/lib/kubelet/config.yaml
staticPodPath: /etc/kubernetes/manifests
] cd /etc/kubernetes/manifests
] cat &gt; web-pod.yaml
add saved output in the above step
] exit
] kubectl get pods # check the static pod
</code></pre></div></div>

<hr />
<h2 id="23-creating-multi-container-pod">2.3. Creating Multi-container Pod</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>] kubectl run lab004 --image=nginx --dry-run=client -o yaml
] cat &gt; multi.yaml
spec:
  containers:
  - image: nginx
    name: nginx
  - image: redis
    name: redis
  - image: memcached
    name: memcached
] kubectl apply -f multi.yaml
] kubectl describe pod lab004
</code></pre></div></div>

<hr />
<h2 id="24-creating-sidecar-container">2.4. Creating Sidecar container</h2>

<p>Sidecar Container: built-in logging architecture<br />
1) log /var/log/html in nginx container (main container)<br />
2) store the log to a separated volume in /varlog<br />
3) access /varlog in side-car container(log analyzing purpose)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>] kubectl get pod eshop-cart-app # main container
] kubectl get pod eshop-cart-app -o yaml &gt; eshop.yaml

</code></pre></div></div>

<h3 id="sidecar-container-with-logging-agent"><a href="https://kubernetes.io/docs/concepts/cluster-administration/logging/#sidecar-container-with-logging-agent">sidecar container with logging agent</a></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>] vi eshop.yaml
spec:
  containers:
  - command:
    - /bin/sh
    - -c
    - 'i=1;while :;do  echo -e "$i: Price: $((RANDOM % 10000 + 1))" &gt;&gt; /var/log/cart-app.log;i=$((i+1)); sleep 2; done'
    image: busybox
    name: cart-app
    volumeMounts:
    - mountPath: /var/log
      name: varlog
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
  - name: sidecar
    image: busybox
    args: [/bin/sh, -c, 'tail -n+1 -F /var/log/cart-app.log']
    volumeMounts:
    - name: varlog
      mountPath: /var/log
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
  volumes:
  - emptyDir: {}
    name: varlog

] kubectl delete pod eshop-cart-app # (--force)
] kubectl apply -f eshop.yaml
] kubectl logs eshop-cart-app -c sidecar
</code></pre></div></div>

<hr />
<h2 id="25-deployment--pod-scale">2.5. Deployment &amp; Pod Scale</h2>

<p><a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#scale">scale reference docs</a></p>

<h3 id="pod-scale-out">Pod scale out</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>] kubectl -n devops get pod deployments.apps
] kubectl -n devops scale deployment eshop-order --replicas=5
] kubectl -n devops get deploy
</code></pre></div></div>

<h3 id="create-and-scale-out-deployment">create and scale out deployment</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>] kubectl create deployment webserver --image=nginx:1.14 --replicas=2 --dry-run=client -o yaml &gt; webserver.yaml
] vi webserver.yaml
spec:
  replicas: 2
  selector:
    matchLabels:
      app_env_stage=dev
  template:
    metadata:
      labels:
        app_env_stage=dev
    spec:
      containers:
      - image: nginx:1.14
        name: webserver
        ports:
        - containerPort: 80
] kubectl apply -f webserver.yaml
] kubectl get deployments.apps -o wide
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>] kubectl scale deployment webserver --replicas=3
] kubectl get pods --show-labels
</code></pre></div></div>

<hr />

  </div><a class="u-url" href="/techblog/kubernetes/2023/06/23/Certified-Kubernetes-Administrator.html" hidden></a>
</article>