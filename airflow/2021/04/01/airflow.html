<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Airflow</h1><p class="page-description">section5</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-04-01T00:00:00-05:00" itemprop="datePublished">
        Apr 1, 2021
      </time>
       ‚Ä¢ <span class="read-time" title="Estimated read time">
    
    
      1 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/techblog/categories/#airflow">airflow</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#5-airflow">5. Airflow</a>
<ul>
<li class="toc-entry toc-h2"><a href="#51-airflow-Íµ¨ÏÑ±">5.1. Airflow Íµ¨ÏÑ±</a>
<ul>
<li class="toc-entry toc-h3"><a href="#dag-Ï¢ÖÎ•ò">DAG Ï¢ÖÎ•ò</a></li>
<li class="toc-entry toc-h3"><a href="#dag-Íµ¨ÏÑ±">DAG Íµ¨ÏÑ±</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#"></a></li>
<li class="toc-entry toc-h2"><a href="#52-airflow-command">5.2. Airflow command</a>
<ul>
<li class="toc-entry toc-h3"><a href="#start-airflow">start Airflow</a></li>
<li class="toc-entry toc-h3"><a href="#list-dags-tasks">list DAGs, tasks</a></li>
<li class="toc-entry toc-h3"><a href="#unpause-dag">unpause DAG</a></li>
<li class="toc-entry toc-h3"><a href="#pause-dag">pause DAG</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#-1"></a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#zookeeper">zookeeper</a>
<ul>
<li class="toc-entry toc-h2"><a href="#-2"></a></li>
</ul>
</li>
</ul><p>üìé <a href="https://airflow.apache.org/docs/">Airflow Docs</a></p>

<hr>

<h1 id="5-airflow">
<a class="anchor" href="#5-airflow" aria-hidden="true"><span class="octicon octicon-link"></span></a>5. Airflow</h1>

<h2 id="51-airflow-Íµ¨ÏÑ±">
<a class="anchor" href="#51-airflow-%EA%B5%AC%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>5.1. Airflow Íµ¨ÏÑ±</h2>

<h3 id="dag-Ï¢ÖÎ•ò">
<a class="anchor" href="#dag-%EC%A2%85%EB%A5%98" aria-hidden="true"><span class="octicon octicon-link"></span></a>DAG Ï¢ÖÎ•ò</h3>

<p>Graph - nodes and edges<br>
Directed Graph - each edged has a direction<br>
Acyclic - no loops (cycle)</p>

<h3 id="dag-Íµ¨ÏÑ±">
<a class="anchor" href="#dag-%EA%B5%AC%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>DAG Íµ¨ÏÑ±</h3>

<p>1) Imports</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># import the libraries

from datetime import timedelta
# The DAG object; we'll need this to instantiate a DAG
from airflow import DAG
# Operators; we need this to write tasks!
from airflow.operators.bash_operator import BashOperator
# This makes scheduling easy
from airflow.utils.dates import days_ago
</code></pre></div></div>

<p>2) DAG Arguments</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#defining DAG arguments

# You can override them on a per-task basis during operator initialization
default_args = {
    'owner': 'Seeeun Cho',
    'start_date': days_ago(0),
    'email': ['nueees@gmail.com'],
    'email_on_failure': True,
    'email_on_retry': True,
    'retries': 1,
    'retry_delay': timedelta(minutes=5),
}
</code></pre></div></div>

<p>3) DAG Definition</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># define the DAG
dag = DAG(
    dag_id='ETL_test_data',
    default_args=default_args,
    description='Apache Airflow etl test',
    schedule_interval=timedelta(days=1),
)
</code></pre></div></div>

<p>4) Task Definitions</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unzip_data = BashOperator(
    task_id='unzip_data',
    bash_command='unzip testdata.tgz -d /home/pjt/stage/"',
    dag=dag,
)
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>extract_data_from_csv = BashOperator(
    task_id='extract_data_from_csv',
    bash_command='cut -f1-4 -d"," test-data.csv &gt; csv_data.csv',
    dag=dag,
)
extract_data_from_fixed_width = BashOperator(
    task_id='extract_data_from_fixed_width',
    bash_command='cut -f1-4 -d"," test-data.txt &gt; fixed_width_data.csv',
    dag=dag,
)
consolidate_data = BashOperator(
    task_id='consolidate_data',
    bash_command='paste csv_data.csv fixed_width_data.csv &gt; extracted_data.csv',
    dag=dag,
)
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>transform_data = BashOperator(
    task_id='transform_data',
    bash_command='tr "[a-z]" "[A-Z]" &lt; extracted_data.csv &gt; transformed_data.csv',
    dag=dag,
)
</code></pre></div></div>

<p>5) Task Pipeline</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># task pipeline
unzip_data &gt;&gt; extract_data_from_csv &gt;&gt; extract_data_from_fixed_width &gt;&gt; consolidate_data &gt;&gt; transform_data
</code></pre></div></div>

<h2>
<a class="anchor" href="#" aria-hidden="true"><span class="octicon octicon-link"></span></a><br><br>
</h2>
<h2 id="52-airflow-command">
<a class="anchor" href="#52-airflow-command" aria-hidden="true"><span class="octicon octicon-link"></span></a>5.2. Airflow command</h2>

<h3 id="start-airflow">
<a class="anchor" href="#start-airflow" aria-hidden="true"><span class="octicon octicon-link"></span></a>start Airflow</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Starting your airflow services....
This process can take up to 15 minutes...
      
Airflow started, waiting for all services to be ready....
      
Your airflow server is now ready to use and available with username: airflow password: password

You can access your Airflow Webserver at: https://blahblah
</code></pre></div></div>
<p>username(airflow)Ïù¥Îûë password Ïπ¥Ìîº
Web UI ÏÇ¨Ïö© Ïãú Ìï¥Îãπ URL(blahblah) ÏÇ¨Ïö©</p>

<h3 id="list-dags-tasks">
<a class="anchor" href="#list-dags-tasks" aria-hidden="true"><span class="octicon octicon-link"></span></a>list DAGs, tasks</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>airflow dags list
airflow tasks list ETL_test_data
</code></pre></div></div>

<h3 id="unpause-dag">
<a class="anchor" href="#unpause-dag" aria-hidden="true"><span class="octicon octicon-link"></span></a>unpause DAG</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>airflow dags unpause ETL_test_data
</code></pre></div></div>

<h3 id="pause-dag">
<a class="anchor" href="#pause-dag" aria-hidden="true"><span class="octicon octicon-link"></span></a>pause DAG</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>airflow dags pause ETL_test_data
</code></pre></div></div>

<h2 id="-1">
<a class="anchor" href="#-1" aria-hidden="true"><span class="octicon octicon-link"></span></a><br><br>
</h2>

<h1 id="zookeeper">
<a class="anchor" href="#zookeeper" aria-hidden="true"><span class="octicon octicon-link"></span></a>zookeeper</h1>

<h2 id="-2">
<a class="anchor" href="#-2" aria-hidden="true"><span class="octicon octicon-link"></span></a><br><br>
</h2>

  </div><a class="u-url" href="/techblog/airflow/2021/04/01/airflow.html" hidden></a>
</article>