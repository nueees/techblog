<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Airflow | Cho’s Tech blog</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Airflow" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="section5" />
<meta property="og:description" content="section5" />
<link rel="canonical" href="https://nueees.github.io/techblog/airflow/2021/04/01/airflow.html" />
<meta property="og:url" content="https://nueees.github.io/techblog/airflow/2021/04/01/airflow.html" />
<meta property="og:site_name" content="Cho’s Tech blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-04-01T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"section5","url":"https://nueees.github.io/techblog/airflow/2021/04/01/airflow.html","@type":"BlogPosting","headline":"Airflow","dateModified":"2021-04-01T00:00:00-05:00","datePublished":"2021-04-01T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://nueees.github.io/techblog/airflow/2021/04/01/airflow.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/techblog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nueees.github.io/techblog/feed.xml" title="Cho's Tech blog" /><link rel="shortcut icon" type="image/x-icon" href="/techblog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/techblog/">Cho&#39;s Tech blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/techblog/about/">About Me</a><a class="page-link" href="/techblog/gitInfo/">gitInfo</a><a class="page-link" href="/techblog/search/">Search</a><a class="page-link" href="/techblog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Airflow</h1><p class="page-description">section5</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-04-01T00:00:00-05:00" itemprop="datePublished">
        Apr 1, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      1 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/techblog/categories/#airflow">airflow</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#5-airflow">5. Airflow</a>
<ul>
<li class="toc-entry toc-h2"><a href="#51-airflow-구성">5.1. Airflow 구성</a>
<ul>
<li class="toc-entry toc-h3"><a href="#dag-종류">DAG 종류</a></li>
<li class="toc-entry toc-h3"><a href="#dag-구성">DAG 구성</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#"></a></li>
<li class="toc-entry toc-h2"><a href="#52-airflow-command">5.2. Airflow command</a>
<ul>
<li class="toc-entry toc-h3"><a href="#start-airflow">start Airflow</a></li>
<li class="toc-entry toc-h3"><a href="#list-dags-tasks">list DAGs, tasks</a></li>
<li class="toc-entry toc-h3"><a href="#unpause-dag">unpause DAG</a></li>
<li class="toc-entry toc-h3"><a href="#pause-dag">pause DAG</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#-1"></a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#zookeeper">zookeeper</a></li>
</ul><p>📎 <a href="https://airflow.apache.org/docs/">Airflow Docs</a></p>

<hr>

<h1 id="5-airflow">
<a class="anchor" href="#5-airflow" aria-hidden="true"><span class="octicon octicon-link"></span></a>5. Airflow</h1>

<h2 id="51-airflow-구성">
<a class="anchor" href="#51-airflow-%EA%B5%AC%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>5.1. Airflow 구성</h2>

<h3 id="dag-종류">
<a class="anchor" href="#dag-%EC%A2%85%EB%A5%98" aria-hidden="true"><span class="octicon octicon-link"></span></a>DAG 종류</h3>

<p>Graph - nodes and edges<br>
Directed Graph - each edged has a direction<br>
Acyclic - no loops (cycle)</p>

<h3 id="dag-구성">
<a class="anchor" href="#dag-%EA%B5%AC%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>DAG 구성</h3>

<p>1) Imports</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># import the libraries

from datetime import timedelta
# The DAG object; we'll need this to instantiate a DAG
from airflow import DAG
# Operators; we need this to write tasks!
from airflow.operators.bash_operator import BashOperator
# This makes scheduling easy
from airflow.utils.dates import days_ago
</code></pre></div></div>

<p>2) DAG Arguments</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#defining DAG arguments

# You can override them on a per-task basis during operator initialization
default_args = {
    'owner': 'Seeeun Cho',
    'start_date': days_ago(0),
    'email': ['nueees@gmail.com'],
    'email_on_failure': True,
    'email_on_retry': True,
    'retries': 1,
    'retry_delay': timedelta(minutes=5),
}
</code></pre></div></div>

<p>3) DAG Definition</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># define the DAG
dag = DAG(
    dag_id='ETL_test_data',
    default_args=default_args,
    description='Apache Airflow etl test',
    schedule_interval=timedelta(days=1),
)
</code></pre></div></div>

<p>4) Task Definitions</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unzip_data = BashOperator(
    task_id='unzip_data',
    bash_command='unzip testdata.tgz -d /home/pjt/stage/"',
    dag=dag,
)
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>extract_data_from_csv = BashOperator(
    task_id='extract_data_from_csv',
    bash_command='cut -f1-4 -d"," test-data.csv &gt; csv_data.csv',
    dag=dag,
)
extract_data_from_fixed_width = BashOperator(
    task_id='extract_data_from_fixed_width',
    bash_command='cut -f1-4 -d"," test-data.txt &gt; fixed_width_data.csv',
    dag=dag,
)
consolidate_data = BashOperator(
    task_id='consolidate_data',
    bash_command='paste csv_data.csv fixed_width_data.csv &gt; extracted_data.csv',
    dag=dag,
)
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>transform_data = BashOperator(
    task_id='transform_data',
    bash_command='tr "[a-z]" "[A-Z]" &lt; extracted_data.csv &gt; transformed_data.csv',
    dag=dag,
)
</code></pre></div></div>

<p>5) Task Pipeline</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># task pipeline
unzip_data &gt;&gt; extract_data_from_csv &gt;&gt; extract_data_from_fixed_width &gt;&gt; consolidate_data &gt;&gt; transform_data
</code></pre></div></div>

<h2>
<a class="anchor" href="#" aria-hidden="true"><span class="octicon octicon-link"></span></a><br><br>
</h2>
<h2 id="52-airflow-command">
<a class="anchor" href="#52-airflow-command" aria-hidden="true"><span class="octicon octicon-link"></span></a>5.2. Airflow command</h2>

<h3 id="start-airflow">
<a class="anchor" href="#start-airflow" aria-hidden="true"><span class="octicon octicon-link"></span></a>start Airflow</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Starting your airflow services....
This process can take up to 15 minutes...
      
Airflow started, waiting for all services to be ready....
      
Your airflow server is now ready to use and available with username: airflow password: password

You can access your Airflow Webserver at: https://blahblah
</code></pre></div></div>
<p>username(airflow)이랑 password 카피
Web UI 사용 시 해당 URL(blahblah) 사용</p>

<h3 id="list-dags-tasks">
<a class="anchor" href="#list-dags-tasks" aria-hidden="true"><span class="octicon octicon-link"></span></a>list DAGs, tasks</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>airflow dags list
airflow tasks list ETL_test_data
</code></pre></div></div>

<h3 id="unpause-dag">
<a class="anchor" href="#unpause-dag" aria-hidden="true"><span class="octicon octicon-link"></span></a>unpause DAG</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>airflow dags unpause ETL_test_data
</code></pre></div></div>

<h3 id="pause-dag">
<a class="anchor" href="#pause-dag" aria-hidden="true"><span class="octicon octicon-link"></span></a>pause DAG</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>airflow dags pause ETL_test_data
</code></pre></div></div>

<h2 id="-1">
<a class="anchor" href="#-1" aria-hidden="true"><span class="octicon octicon-link"></span></a><br><br>
</h2>

<h1 id="zookeeper">
<a class="anchor" href="#zookeeper" aria-hidden="true"><span class="octicon octicon-link"></span></a>zookeeper</h1>

  </div><a class="u-url" href="/techblog/airflow/2021/04/01/airflow.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/techblog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/techblog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/techblog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>A challenge-loving junior data engineer.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/nueees" target="_blank" title="nueees"><svg class="svg-icon grey"><use xlink:href="/techblog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/nueees" target="_blank" title="nueees"><svg class="svg-icon grey"><use xlink:href="/techblog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
